<html>
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="description" content="创新实践服务外包O2O资源回收平台">
        <meta name="author" content="zy">
        <link rel="icon" href="./images/icon.ico">
    
        <title>个人中心</title>
    
        <!--         CSS          -->
        <link rel="stylesheet" href="./css/style.css">
        <link rel="stylesheet" href="./css/bootstrap.min.css">
        <link rel="stylesheet" href="./css/font-awesome.min.css">
        <link rel="stylesheet" href="./css/bootstrap-datetimepicker.min.css">
        <link rel="stylesheet" href="./css/skins/square/blue.css">
        <link rel="stylesheet" href="./css/buttons.css">
        <!--         JS           -->
        <script src="./js/jquery-3.3.1.min.js"></script>
        <script src="./js/bootstrap.min.js"></script>
        <script src="./js/bootstrap-datetimepicker.min.js"></script>
        <script src="./js/icheck.min.js"></script>
        <script src="./js/buttons.js"></script>
    </head>

    <body>
        <nav class="navbar navbar-inverse navbar-fixed-top">
            <div class="container">
                <div class="navbar-header">
                    <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
                        <span class="sr-only">Toggle navigation</span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>
                    <img src="./images/icon.ico" class="my-bar-icon">
                    <a href="#" class="navbar-brand" style="color: #eee;">我的地址</a>
                </div>
                <div id="navbar" class="collapse navbar-collapse">
                    <ul class="nav navbar-nav">
                        <li><a href="index.html">主页</a></li>
                        <li><a href="sell.html">我要出售</a></li>
                        <li><a href="recover.html">我要回收</a></li>
                        <li><a href="orders.html">我的订单</a></li>
                        <li><a href="wallet.html">我的钱包</a></li>
                        <li class="active">
                            <a href="personal-center.html">个人中心</a>
                        </li>
                        <li><a href="about.html">关于</a></li>
                        <li><a href="login.html">登录</a></li>
                    </ul>
                </div>
            </div>
        </nav>
        <div class="wrapper">
            <div class="container">
                <div class="row">
                    <div class="pd-re title-re">
                        <h2>我的地址</h2>
                    </div>
                </div>
            </div>
            <div class="container" id="father">
                <div class="address-item" id="template">
                    <div class="container pd-ad1">
                        <div class="row">
                            <div class="col-xs-1">
                                <img src="images/icon.ico" class="ad-icon">
                            </div>
                            <div class="col-xs-3">
                                <p class="ad-tt" id="addrcnt">地址一</p>
                            </div>
                        </div>
                        <div class="container pd">
                            <div class="row">
                                <div class="col-xs-3">
                                    <p id="name">郑雨</p>
                                </div>
                                <div class="col-xs-4 pull-right">
                                    <p id="tel">15968812297</p>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-xs-11">
                                    <p id="addressInfor">浙江省 杭州市 江干区 白杨街道 杭州电子科技大学生活区 12楼</p>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <center>
                                <div class="button-group my-btgp">
                                    <button id="modify" value="0" onclick="pass(this)"
                                        class="button button-inverse button-small"
                                        data-toggle="modal"
                                        data-target="#modifyAddr">
                                        <p>编辑</p>
                                    </button>
                                    <script>
                                        function pass(obj){
                                            add_id = obj.value;
                                            $('#sub').val(`${add_id}`);
                                        }
                                    </script>
                                    <div class="modal fade" id="modifyAddr" tabindex="-1" role="dialog">
                                            <div class="modal-dialog" role="document">
                                                <div class="modal-content">
                                                    <div class="modal-header">
                                                        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                                                        <h4 class="modal-title" id="myModalLabel">编辑地址</h4>
                                                    </div>
                                                    <div class="modal-body">
                                                        <div class="input-group">
                                                            <span class="input-group-addon">姓名</span>
                                                            <input type="text" class="form-control" placeholder="Name" id="modifyName">
                                                        </div>
                                                        <div class="input-group" style="margin-top: 5%">
                                                            <span class="input-group-addon">手机号码</span>
                                                            <input type="text" class="form-control" placeholder="Tel" id="modifyTel">
                                                        </div>
                                                        <div class="input-group" style="margin-top: 5%">
                                                            <span class="input-group-addon">地址</span>
                                                            <input type="text" class="form-control" placeholder="Address" id="nAddr">
                                                        </div>
                                                    </div>
                                                    <div class="modal-footer">
                                                        <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
                                                        <!-- 修改地址 -->
                                                        <button id="sub" value="" onclick="sub(this)" class="btn btn-primary">修改</button>
                                                        <script>
                                                            function sub(obj){
                                                                var add_id = obj.value, name=$('#modifyName').val(), tel=$('#modifyTel').val(), address=$('#nAddr').val();
                                                                $.post('/modify_address',{add_id:add_id,name:name,tel:tel,address:address},function(data){
                                                                    if (data.code===1) modifySuccess();
                                                                    else modifyFailed(data.err);
                                                                })
                                                            }
                                                        </script>
                                                    </div>
                                                    <script>
                                                        function modifySuccess(){
                                                            $('#modifyS').removeAttr("hidden");
                                                        }
                                                        function modifyFailed(err){
                                                            $('#modifyF').removeAttr("hidden");
                                                            document.getElementById("modifyAddressError").innerHTML=err;
                                                        }
                                                    </script>
                                                    <h5 class="modify-error" id="modifyS" hidden="hidden"><strong>修改成功！</strong></h5>
                                                    <h5 class="modify-error" id="modifyF" hidden="hidden"><strong>修改失败：<span id="modifyAddressError"></span></strong></h5>
                                                </div>
                                            </div>
                                    </div>
                                    <button id="delete" value="0" onclick="removeAddr(this)" class="button button-inverse button-small"><p>删除</p></button>
                                </div>
                                <script>
                                    function removeAddr(obj){
                                        //alert(obj.value);
                                        var add_id = obj.value;
                                        $.post('/remove_address',{add_id:add_id},function(data){
                                            if (data.code===1) removeAddrSuccess(add_id);
                                            else removeAddrFailed();
                                            })
                                    }
                                    function removeAddrSuccess(add_id){
                                        $(`#addrson${add_id}`).remove();
                                    }
                                    function removeAddrFailed(){
                                        alert("删除失败！");
                                    }
                                </script>
                            </center>
                        </div>
                    </div>
                </div>
            </div>
            <!-- 添加地址 -->
            <div class="container">
                <!-- Button trigger modal -->
                <button onclick="addAddress()"class="button button-glow button-border button-rounded button-primary" 
                style="width: 100%;margin-top: 10%;"
                data-toggle="modal" data-target="#add">
                    添加地址
                </button>
                <!-- Modal -->
                    <div class="modal fade" id="add" tabindex="-1" role="dialog">
                        <div class="modal-dialog" role="document">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                                    <h4 class="modal-title" id="myModalLabel">添加地址</h4>
                                </div>
                                <div class="modal-body">
                                    <div class="input-group">
                                        <span class="input-group-addon">姓名</span>
                                        <input type="text" class="form-control" placeholder="Name" id="newName">
                                    </div>
                                    <div class="input-group" style="margin-top: 5%">
                                        <span class="input-group-addon">手机号码</span>
                                        <input type="text" class="form-control" placeholder="Tel" id="newTel">
                                    </div>
                                    <div class="input-group" style="margin-top: 5%">
                                        <span class="input-group-addon">地址</span>
                                        <input type="text" class="form-control" placeholder="Address" id="address">
                                    </div>
                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
                                    <button onclick="add()" class="btn btn-primary">添加</button>
                                </div>
                                <h5 class="modify-error" id="addS" hidden="hidden"><strong>添加成功！</strong></h5>
                                <h5 class="modify-error" id="addF" hidden="hidden"><strong>添加失败：<span id="addAddressError"></span></strong></h5>
                            </div>
                        </div>
                    </div>
            </div>
            <script>
                function add(){
                    var name=$("#newName").val(),tel=$("#newTel").val(),address=$("#address").val();
                    $.post('/add_address',{name:name,tel:tel,address:address},function(data){
                        if (data.code===1) addSuccess();
                        else addFailed(data.err);
                    })
                }
                function addSuccess(){
                    $('#addS').removeAttr("hidden");
                }
                function addFailed(err){
                    $('#addF').removeAttr("hidden");
                    document.getElementById("addAddressError").innerHTML=err;
                }
            </script>
        </div>
        <script>
            $.get('/getaddresses',function(data){
                var n=data.addresses.length;
                //添加address模块；
                var tmp=$("#template");
                for (var i=0;i<n;i++){
                    var newtmp=tmp.clone();
                    newtmp.attr('id','addrson'+data.addresses[i].add_id);
                    $("#father").append(newtmp);
                    $(`#${"addrson"+data.addresses[i].add_id} #addrcnt`).text(`地址${i+1}`);
                    $(`#${"addrson"+data.addresses[i].add_id} #name`).text(data.addresses[i].name);
                    $(`#${"addrson"+data.addresses[i].add_id} #tel`).text(data.addresses[i].tel);
                    $(`#${"addrson"+data.addresses[i].add_id} #addressInfor`).text(data.addresses[i].address);   
                    $(`#${"addrson"+data.addresses[i].add_id} #delete`).val(`${data.addresses[i].add_id}`);
                    $(`#${"addrson"+data.addresses[i].add_id} #modify`).val(`${data.addresses[i].add_id}`);          
                }
                tmp.remove();
            });
        </script>
    </body>
</html>